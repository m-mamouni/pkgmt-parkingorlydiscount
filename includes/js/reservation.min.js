var $=jQuery.noConflict();$(document).ready(function(){function e(e,t){var a;return $.ajax({url:e,data:t,dataType:"json",type:"POST",async:!1,success:function(e){a=e}}),a}function t(){$("#home_form_estimation").empty()}function a(e){i("ext-tarif","Parking extérieur",e.ext,e.nbr,"extérieur","ext"),i("int-tarif","Parking intérieur",e.int,e.nbr,"intérieur","int")}function i(e,t,a,i,r,d){var l=$("<div></div>").attr("id",e+"-title").text(t),u=$("<div></div>").attr("id",e+"-days").addClass("pkmgmt-days").text(i+" jours"),m=$("<div></div>").attr("id",e+"-amount").addClass("pkmgmt-amount").text("€ "+a),s=$("<div></div>").attr("id",e+"-header").addClass("pkmgmt-header").append(l).append($("<div></div>").attr("id",e+"-subheader").append(m).append(u)),p=$("<div></div>").attr("id",e+"-body").addClass("pkmgmt-body").append(n(e+"-ul",r));$('<div style="display:none"></div>').attr("id",e).append(s).append(p).append(o(e,h.datepicker("getDate"),b.datepicker("getDate"),d)).appendTo($("#home_form_estimation")).slideDown("slow")}function n(e,t){return $("<ul></ul>").addClass(e).append(r("tarif-list-li","Navette comprise")).append(r("tarif-list-li","Parking sécurisé")).append(r("tarif-list-li","Parking "+t))}function r(e,t){return $("<li></li>").addClass(e).text(t)}function d(e,t){var a=$("<div></div>").appendTo($("body"));a.addClass("dialog-message"),a.attr("title",e),$("<p></p>").text(t).appendTo(a),$("#dialog-message").dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close"),$("#dialog-message").remove()}}})}function o(e,t,a,i){return $("<form></form>").attr("id",e).attr("name",e).attr("action","/reservation").attr("method","post").addClass(e+"-"+i+"-form").append($('<input name="navette" type="hidden">').attr("value",t)).append($('<input name="date_retour" type="hidden">').attr("value",a)).append($('<input name="type" type="hidden">').attr("value",i)).append($("<button>Reserver</button>"))}function l(){return u(new Date)?c:new Date}function u(e){var t=c;return e.getTime()<=t.getTime()}function m(e){$("#conditiongenerale").val()&&(e&&$("#conditiongenerale").is(":checked")?$("#submitbtn").removeAttr("disabled"):$("#submitbtn").attr("disabled","disabled"))}function s(e){var t=/(\d{2})\/(\d{2})\/(\d{4}) (.*)/;return new Date(e.replace(t,"$3-$2-$1 $4"))}jQuery(function(e){e.datepicker.regional.fr={closeText:"Fermer",prevText:"<Préc",nextText:"Suiv>",currentText:"Courant",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.fr)}),$("form *:input[name=nom]").focus(),$("#conditiongenerale").val()&&($("#conditiongenerale").is(":checked")||$("#submitbtn").attr("disabled","disabled"),$("#conditiongenerale").change(function(){m($(this).is(":checked"))}));var p="Parking Complet \njusqu'au 7 mai inclus",c=new Date("05/08/2018 00:00:00"),v=l(),f=$("#navette"),g=$("#date_retour"),h=$("#homenavette"),b=$("#homeresadateretour");h.prop("readonly",!0).datepicker({minDate:v,dateFormat:"dd/mm/yy",numberOfMonths:1,beforeShow:function(e,a){t(),b.empty(),$(this).dialog("widget").css("z-index",60),setTimeout(function(){$("#ui-datepicker-div").css("z-index",70)},0)},onSelect:function(e){b.datepicker("option","minDate",h.datepicker("getDate"))}}),b.prop("readonly",!0).datepicker({minDate:v,dateFormat:"dd/mm/yy",numberOfMonths:1,beforeShow:function(e,t){$(this).dialog("widget").css("z-index",15),setTimeout(function(){$("#ui-datepicker-div").css("z-index",70)},0)},onClose:function(t){var i={action:"getTarifByDate",post_id:ajax_object.postid,navette:h.datepicker("getDate"),date_retour:b.datepicker("getDate")},n=e(ajax_object.ajax_url,i);a(n)}}),f.datetimepicker({hourMin:3,controlType:"select",stepMinute:5,minDate:v,minuteMin:0,dateFormat:"dd/mm/yy",beforeShow:function(e,t){$(this).dialog("widget").css("z-index",15),setTimeout(function(){$("#ui-datepicker-div").css("z-index",16)},0)},showButtonPanel:!0,onSelect:function(e){g.datetimepicker("option","minDate",f.datetimepicker("getDate"))},onClose:function(e){u(s(e))?(alert(p),m(!1)):m(!0),u(s(e))?(d("Parking Complet",p),m(!1)):m(!0)}}),g.datetimepicker({hourMin:3,controlType:"select",stepMinute:5,minDate:v,dateFormat:"dd/mm/yy",showButtonPanel:!0,beforeShow:function(){$(this).dialog("widget").css("z-index",200)}});var y=ajax_object.indicatif?ajax_object.indicatif:"fr";$("#mobile").intlTelInput({onlyCountries:["fr","be","ch","de","nl"],autoPlaceholder:!1,autoHideDialCode:!1,nationalMode:!1,preferredCountries:[y],utilsScript:ajax_object.pkmgmt_includes_dir+"/js/utils.js"}),$.validator.addMethod("mobileFR",function(e,t){return!!$("#mobile").intlTelInput("isValidNumber")},"Verifiez le numéro de téléphone"),$.validator.addMethod("codepostalFR",function(e,t){regexp=/^[\d]{4}|[\d]{5}$/;return this.optional(t)||regexp.test(e)},"Verifiez le code postal"),$.extend(!0,$.validator.messages,{required:"Ce champ est requis.",email:"Adresse invalide.",date:"Date invalide.",number:"Nombre invalide",digits:"Nombre uniquement",maxlength:$.validator.format("Pas plus de {0} caracteres."),minlength:$.validator.format("Veuillez entrez au moins {0} caractères."),rangelength:$.validator.format("Veuillez entrer une valeur entre {0} et {1} caractère de long."),range:$.validator.format("Veuillez entrer une valeur entre {0} et {1}."),max:$.validator.format("Veuillez entrer une valeur inférieur ou égale à {0}."),min:$.validator.format("Veuillez entrer une valeur supérieur ou égale à {0}.")}),$("#pkmgmt-reservation").validate({rules:{nom:{minlength:2,required:!0},prenom:{minlength:2,required:!0},cp:{codepostalFR:!0,digits:!0,required:!0},email:{required:!0,email:!0},mobile:{mobileFR:!0,required:!0},destination:{minlength:4,required:!0},immatriculation:{minlength:6,required:!0},modele:{minlength:2,required:!0},navette:{required:!0},date_retour:{required:!0},nbr_retour:{digits:!0,min:1,max:8,required:!0}},highlight:function(e){$(e).closest(".control-group").removeClass("success").addClass("error")},success:function(e){e.text("OK!").removeClass("error").addClass("valid").addClass("success").closest(".control-group")},submitHandler:function(e){if(0==ajax_object.autovalid)return void e.submit();var t=s($("#pkmgmt-reservation").find("input[name^=navette]").val());if(u(t))return void alert(p);var a=$("<div></div>").appendTo($("body"));a.dialog({autoOpen:!1,show:"fade",hide:"fade",width:"auto",minWidth:"350",modal:!0,id:"dialog_print",title:"Confirmation de réservation",buttons:[{text:"Annuler",click:function(){$(this).dialog("close")}},{id:"ValidDialogButton",text:"Valider",click:function(){e.submit()}}]});var i=$("<form></form>").attr("id","valid-form").attr("name","valid-form"),n=$("<table></table>").attr("id","table_validation").addClass("validation"),r=$("<tr></tr>"),d=$("<input />").attr("type","text").attr("id","email").attr("name","email").val($("#pkmgmt-reservation").find("input[name^=email]").val()),o=$("<input />").attr("type","text").attr("id","vnavette").attr("name","vnavette").change(function(){$("#pkmgmt-reservation").find("input[name^=navette]").val($(this).val())}).datetimepicker({controlType:"select",hourMin:3,stepMinute:5,minDate:v,minuteMin:0,dateFormat:"dd/mm/yy",onSelect:function(e){l.datetimepicker("option","minDate",o.datetimepicker("getDate"))},beforeShow:function(e,t){$(this).dialog("widget").css("z-index",200)},showButtonPanel:!0}).val($("#pkmgmt-reservation").find("input[name^=navette]").val()),l=$("<input />").attr("type","text").attr("id","vdate_retour").attr("name","vdate_retour").change(function(){$("#pkmgmt-reservation").find("input[name^=date_retour]").val($(this).val())}).datetimepicker({controlType:"select",hourMin:3,stepMinute:5,minDate:v,minuteMin:0,dateFormat:"dd/mm/yy",beforeShow:function(e,t){$(this).dialog("widget").css("z-index",200)},showButtonPanel:!0}).val($("#pkmgmt-reservation").find("input[name^=date_retour]").val());$("<td></td>").append("email").appendTo(r),$("<td></td>").append(d.change(function(){$("#pkmgmt-reservation").find("input[name^=email]").val($(this).val())})).appendTo(r),$("<tbody></tbody>").append(r).append($("<tr></tr>").append($("<td></td>").append("Date d'aller")).append($("<td></td>").append(o))).append($("<tr></tr>").append($("<td></td>").append("Date de retour")).append($("<td></td>").append(l))).appendTo(n),i.append(n),a.append(i).dialog("open")},errorElement:"span",errorPlacement:function(e,t){"mobile"==t.attr("name")?(t.parent().parent("td").next("td").empty(),e.appendTo(t.parent().parent("td").next("td"))):(t.parent("td").next("td").empty(),e.appendTo(t.parent("td").next("td")))}})});